{"filename": "contracts/fundraising/Fundraiser.sol", "patch": "@@ -451,7 +451,6 @@ contract Fundraiser is Ownable {\n       uint256 overHardCap;\n \n       (overHardCap, acceptedAmount) = _processHardCap(acceptedAmount);\n-\n       refund = refund.add(overHardCap);\n \n       _addQualifiedInvestment(_contributor, acceptedAmount, _referral);\n@@ -494,10 +493,10 @@ contract Fundraiser is Ownable {\n     bool hardcapReached;\n \n     (hardcapReached, _overHardCap) = _validateHardCap(amountQualified.add(_amount));\n+    _underHardcap = _amount.sub(_overHardCap);\n \n     if (hardcapReached) {\n       isHardcapReached = hardcapReached;\n-      _underHardcap = _underHardcap.sub(_overHardCap);\n       require(_underHardcap != 0, 'Fundraiser: Hardcap already reached');\n     }\n   }\n@@ -507,15 +506,17 @@ contract Fundraiser is Ownable {\n     address _contributor,\n     uint256 _amount\n   ) internal view returns (uint256 _overMax, uint256 _acceptedAmount) {\n+    _overMax = 0;\n+    _acceptedAmount = _amount;\n     uint256 maxAmount = ContributorRestrictions(contributorRestrictions).maxAmount();\n \n     uint256 currentAmount =\n       _qualified ? qualifiedContributions[_contributor] : pendingContributions[_contributor];\n \n-    _acceptedAmount = currentAmount.add(_amount);\n+    uint256 totalAmount = currentAmount.add(_amount);\n \n-    if (!ContributorRestrictions(contributorRestrictions).checkMaxInvestment(_acceptedAmount)) {\n-      _overMax = _acceptedAmount.sub(maxAmount);\n+    if (!ContributorRestrictions(contributorRestrictions).checkMaxInvestment(totalAmount)) {\n+      _overMax = totalAmount.sub(maxAmount);\n       _acceptedAmount = _amount.sub(_overMax);\n       require(_acceptedAmount != 0, 'Fundraiser: Cannot invest more than maxAmount');\n     }", "project_link": "https://github.com/my-swarm/contracts/commit/52aedad30d589f9023ed5bc096dda5f807ba7ef1", "solc_version": "0.8.9", "packages": "", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "9f6684919790e878d1def7c9088a400ba3c8735d"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "52aedad30d589f9023ed5bc096dda5f807ba7ef1"}}