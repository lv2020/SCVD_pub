{"filename": "contracts/RewardPool.sol", "patch": "@@ -216,21 +216,15 @@ contract RewardPool is Ownable {\n         require(stakingTokenIndexes[address(_token)].added, \"invalid token\");\n         \n         uint256 _pid = stakingTokenIndexes[address(_token)];\n-        \n         checkpoint(_pid);\n         StakingToken storage pool = stakingTokens[_pid];\n         UserInfo storage user = userInfo[_pid][msg.sender];\n+        uint256 pending = user.amount.mul(pool.accRewardPerShare).div(1e12).sub(user.rewardDebt);\n+        user.amount = user.amount.add(_amount);\n         user.rewardDebt = user.amount.mul(pool.accRewardPerShare).div(1e12);\n-\n-        if (user.amount > 0) {\n-            uint256 pending = user.amount.mul(pool.accRewardPerShare).div(1e12).sub(user.rewardDebt);\n-            if(pending > 0) {\n-                safeRewardTransfer(msg.sender, pending);\n-            }\n-        }\n-\n-        if(_amount > 0) {\n-            user.amount = user.amount.add(_amount);\n+        \n+        safeRewardTransfer(msg.sender, pending);\n+        if (_amount > 0) {\n             pool.stakingToken.safeTransferFrom(address(msg.sender), address(this), _amount);\n         }\n \n@@ -246,16 +240,14 @@ contract RewardPool is Ownable {\n         StakingToken storage pool = stakingTokens[_pid];\n         UserInfo storage user = userInfo[_pid][msg.sender];\n         require(user.amount >= _amount, \"invalid amount specified\");\n+\n         checkpoint(_pid);\n         uint256 pending = user.amount.mul(pool.accRewardPerShare).div(1e12).sub(user.rewardDebt);\n+        user.amount = user.amount.sub(_amount);\n         user.rewardDebt = user.amount.mul(pool.accRewardPerShare).div(1e12);\n \n-        if(pending > 0) {\n-            safeRewardTransfer(msg.sender, pending);\n-        }\n-\n+        safeRewardTransfer(msg.sender, pending);\n         if(_amount > 0) {\n-            user.amount = user.amount.sub(_amount);\n             pool.stakingToken.safeTransfer(address(msg.sender), _amount);\n         }\n \n@@ -283,10 +275,12 @@ contract RewardPool is Ownable {\n         internal \n     {\n         uint256 rewardBal = rewardToken.balanceOf(address(this));\n-        if (_amount > rewardBal) {\n-            rewardToken.transfer(_to, rewardBal);\n-        } else {\n-            rewardToken.transfer(_to, _amount);\n+        if (_amount > 0) {\n+            if (_amount > rewardBal) {\n+                rewardToken.transfer(_to, rewardBal);\n+            } else {\n+                rewardToken.transfer(_to, _amount);\n+            }\n         }\n     }\n ", "project_link": "https://github.com/KEYFIAI/keyfi-token/commit/a1eceb542424c3e2d28328bf0a914b3ebd190dd5", "solc_version": "0.5.0", "packages": "", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "39ecb35c813d4f124cb2d20c4ec52fb31cb5a71e"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "a1eceb542424c3e2d28328bf0a914b3ebd190dd5"}}