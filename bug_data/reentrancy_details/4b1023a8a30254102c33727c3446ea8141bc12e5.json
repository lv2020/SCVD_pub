{"filename": "contracts/MarketMaker.sol", "patch": "@@ -205,9 +205,6 @@ contract MarketMaker is Ownable, ERC1155TokenReceiver {\n \n         if(outcomeTokenNetCost < 0) {\n             mergePositionsThroughAllConditions(uint(-outcomeTokenNetCost));\n-            if(netCost < 0) {\n-                require(collateralToken.transfer(msg.sender, uint(-netCost)));\n-            }\n         }\n \n         emit AMMOutcomeTokenTrade(msg.sender, outcomeTokenAmounts, outcomeTokenNetCost, uint(fees));\n@@ -222,6 +219,10 @@ contract MarketMaker is Ownable, ERC1155TokenReceiver {\n             }\n         }\n         if(touched) pmSystem.safeBatchTransferFrom(address(this), msg.sender, positionIds, transferAmounts, \"\");\n+\n+        if(netCost < 0) {\n+            require(collateralToken.transfer(msg.sender, uint(-netCost)));\n+        }\n     }\n \n     /// @dev Calculates fee to be paid to market maker", "project_link": "https://github.com/gnosis/conditional-tokens-market-makers/commit/4b1023a8a30254102c33727c3446ea8141bc12e5", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "0f271e7b7926c3d1326eea781e12ff08b9245b13"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "4b1023a8a30254102c33727c3446ea8141bc12e5"}}