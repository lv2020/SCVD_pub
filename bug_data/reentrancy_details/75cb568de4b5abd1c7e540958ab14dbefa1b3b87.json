{"filename": "contracts/RFOXAUCTION.sol", "patch": "@@ -167,6 +167,7 @@ contract RFOXAUCTION is OwnerPausable, IERC721Receiver {\n    * @param _bidPricePercent percent\n   */\n   function setBidPricePercent(uint _bidPricePercent) external onlyOwner {\n+    require(_bidPricePercent >= MIN_BID_PRICE_PERCENT && _bidPricePercent <= MAX_BID_PRICE_PERCNET, \"Invalid Bid Price Percent\");\n     bidPricePercent = _bidPricePercent;\n     emit SetBidPricePercent(_msgSender(), _bidPricePercent);\n   }\n@@ -195,19 +196,7 @@ contract RFOXAUCTION is OwnerPausable, IERC721Receiver {\n    * @param _auctionId auction id to end\n   */\n   function endAuction(uint _auctionId) external validId(_auctionId) validSeller(_auctionId) {\n-    AuctionInfo storage auction = auctions[_auctionId];\n-    require(auction.end < block.timestamp, \"Auction: Not ended yet\");\n-\n-    auction.status = AuctionStatus.Ended;\n-\n-    if(auction.bidder != address(0)) {\n-      (bool success, ) = auction.seller.call{ value: auction.price}(\"\");\n-      require(success, 'Auction: unable to send value, recipient may have reverted');\n-      IERC721(auction.nft).safeTransferFrom(address(this), auction.bidder, auction.itemId);\n-    }\n-\n-    wonCount[auction.bidder] = wonCount[auction.bidder].add(1);\n-    emit EndAuction(_msgSender(), _auctionId);\n+    _finalizeAuction(_auctionId);\n   }\n \n   /**\n@@ -216,9 +205,14 @@ contract RFOXAUCTION is OwnerPausable, IERC721Receiver {\n    * @param _auctionId auction id to end\n   */\n   function claimAuction(uint _auctionId) external validId(_auctionId) validWinner(_auctionId) {\n+    _finalizeAuction(_auctionId);\n+  }\n+\n+  function _finalizeAuction(uint _auctionId) private {\n     AuctionInfo storage auction = auctions[_auctionId];\n     require(auction.end < block.timestamp, \"Auction: Not ended yet\");\n \n+    require(auction.status == AuctionStatus.Normal);\n     auction.status = AuctionStatus.Ended;\n \n     if(auction.bidder != address(0)) {", "project_link": "https://github.com/RFL-Valt/rfoxvalt-contract/commit/75cb568de4b5abd1c7e540958ab14dbefa1b3b87", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "3714f17bbb13dfc429af1579dad2a4c48d376c66"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "75cb568de4b5abd1c7e540958ab14dbefa1b3b87"}}