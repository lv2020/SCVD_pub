{"filename": "solidity/xcall/contracts/CallService.sol", "patch": "@@ -199,6 +199,8 @@ contract CallService is IBSH, ICallService, IFixedFees, Initializable {\n     ) external override {\n         Types.CSMessageRequest memory req = proxyReqs[_reqId];\n         require(!isNullCSMessageRequest(req), \"InvalidRequestId\");\n+        // cleanup\n+        delete proxyReqs[_reqId];\n \n         //TODO require BTPAddress validation\n         (string memory netFrom, ) = req.from.splitBTPAddress();\n@@ -219,9 +221,6 @@ contract CallService is IBSH, ICallService, IFixedFees, Initializable {\n //            errMsg = string(\"unknownError \").concat(Strings.bytesToHex(err));\n         }\n \n-        // cleanup\n-        delete proxyReqs[_reqId];\n-\n         // send response only when there was a rollback\n         if (req.rollback) {\n             bytes memory payload = Types.CSMessageResponse(\n@@ -255,6 +254,7 @@ contract CallService is IBSH, ICallService, IFixedFees, Initializable {\n         Types.CallRequest memory req = requests[_sn];\n         require(!isNullCallRequest(req), \"InvalidSerialNum\");\n         require(req.enabled, \"RollbackNotEnabled\");\n+        cleanupCallRequest(_sn);\n \n         try this.tryHandleCallMessage(\n             req.from,\n@@ -264,7 +264,6 @@ contract CallService is IBSH, ICallService, IFixedFees, Initializable {\n         } catch {\n             //logging\n         }\n-        cleanupCallRequest(_sn);\n     }\n \n     /* Implementation-specific eventlog */", "project_link": "https://github.com/icon-project/btp/commit/3747a9c81ff3f80171779cb88a49fd6fd2406eab", "solc_version": "0.5.0", "packages": "", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "c052aec3579a9106f9ebc3594a25135dff3db356"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "3747a9c81ff3f80171779cb88a49fd6fd2406eab"}}