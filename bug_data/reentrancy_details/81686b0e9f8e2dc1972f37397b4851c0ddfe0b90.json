{"filename": "contracts/upgradeable_contracts/amb_erc20_to_native/HomeAMBErc20ToNative.sol", "patch": "@@ -3,13 +3,14 @@ pragma solidity 0.4.24;\n import \"./BasicAMBErc20ToNative.sol\";\n import \"./HomeFeeManagerAMBErc20ToNative.sol\";\n import \"../BlockRewardBridge.sol\";\n+import \"../ReentrancyGuard.sol\";\n \n /**\n * @title HomeAMBErc20ToNative\n * @dev Home mediator implementation for erc20-to-native bridge intended to work on top of AMB bridge.\n * It is design to be used as implementation contract of EternalStorageProxy contract.\n */\n-contract HomeAMBErc20ToNative is BasicAMBErc20ToNative, BlockRewardBridge, HomeFeeManagerAMBErc20ToNative {\n+contract HomeAMBErc20ToNative is BasicAMBErc20ToNative, BlockRewardBridge, HomeFeeManagerAMBErc20ToNative, ReentrancyGuard {\n     bytes32 internal constant TOTAL_BURNT_COINS = 0x17f187b2e5d1f8770602b32c1159b85c9600859277fae1eaa9982e9bcf63384c; // keccak256(abi.encodePacked(\"totalBurntCoins\"))\n \n     /**\n@@ -141,9 +142,11 @@ contract HomeAMBErc20ToNative is BasicAMBErc20ToNative, BlockRewardBridge, HomeF\n     */\n     function nativeTransfer(address _receiver) internal {\n         // this check also validates that msg.value is positive, since minPerTx() > 0\n+        require(!lock());\n         require(withinLimit(msg.value));\n \n         IBlockReward blockReward = blockRewardContract();\n+        setLock(true);\n         uint256 totalMinted = blockReward.mintedTotallyByBridge(address(this));\n         uint256 totalBurnt = totalBurntCoins();\n         require(msg.value <= totalMinted.sub(totalBurnt));\n@@ -158,8 +161,9 @@ contract HomeAMBErc20ToNative is BasicAMBErc20ToNative, BlockRewardBridge, HomeF\n             emit FeeDistributed(fee, _messageId);\n             valueToTransfer = valueToTransfer.sub(fee);\n         }\n-\n+        \n         passMessage(msg.sender, _receiver, valueToTransfer);\n+        setLock(false);\n         _burnCoins(valueToTransfer);\n     }\n ", "project_link": "https://github.com/cardstack/tokenbridge-contracts/commit/81686b0e9f8e2dc1972f37397b4851c0ddfe0b90", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "b42c6eb7e53919d4bfcd0541d86e1e00e82ecebc"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "81686b0e9f8e2dc1972f37397b4851c0ddfe0b90"}}