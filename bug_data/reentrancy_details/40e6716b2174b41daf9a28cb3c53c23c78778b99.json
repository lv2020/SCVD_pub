{"filename": "contracts/pools/SinglePool.sol", "patch": "@@ -148,17 +148,19 @@ contract SinglePool is Ownable {\n \n         updatePool(0);\n         \n+        uint256 reward;\n         if (user.amount > 0) {\n             uint256 pending = user.amount.mul(pool.accRewardsPerShare).div(1e18).sub(user.rewardDebt);\n             if(pending > 0) {\n                 uint256 bal = rewardToken.balanceOf(address(this));\n                 if(bal >= pending) {\n-                    rewardToken.safeTransfer(address(msg.sender), pending);\n+                    reward = pending;\n                 } else {\n-                    rewardToken.safeTransfer(address(msg.sender), bal);\n+                    reward = bal;\n                 }\n             }\n         }\n+\n         if(_amount > 0) {\n             uint256 oldBal = pool.lpToken.balanceOf(address(this));\n             pool.lpToken.safeTransferFrom(address(msg.sender), address(this), _amount);\n@@ -169,6 +171,10 @@ contract SinglePool is Ownable {\n         }\n         user.rewardDebt = user.amount.mul(pool.accRewardsPerShare).div(1e18);\n \n+        if (reward > 0) {\n+            rewardToken.safeTransfer(address(msg.sender), reward);\n+        }\n+        \n         emit Deposit(msg.sender, _amount);\n     }\n \n@@ -177,8 +183,18 @@ contract SinglePool is Ownable {\n         PoolInfo storage pool = poolInfo[0];\n         UserInfo storage user = userInfo[msg.sender];\n         require(user.amount >= _amount, \"withdraw: not good\");\n+\n         updatePool(0);\n+\n         uint256 pending = user.amount.mul(pool.accRewardsPerShare).div(1e18).sub(user.rewardDebt);\n+        \n+        if(_amount > 0) {\n+            user.amount = user.amount.sub(_amount);\n+            totalDeposit = totalDeposit.sub(_amount);\n+            pool.lpToken.safeTransfer(address(msg.sender), _amount);\n+        }\n+        user.rewardDebt = user.amount.mul(pool.accRewardsPerShare).div(1e18);\n+\n         if(pending > 0) {\n             uint256 bal = rewardToken.balanceOf(address(this));\n             if(bal >= pending) {\n@@ -187,13 +203,6 @@ contract SinglePool is Ownable {\n                 rewardToken.safeTransfer(address(msg.sender), bal);\n             }\n         }\n-        if(_amount > 0) {\n-            user.amount = user.amount.sub(_amount);\n-            totalDeposit = totalDeposit.sub(_amount);\n-            pool.lpToken.safeTransfer(address(msg.sender), _amount);\n-        }\n-        user.rewardDebt = user.amount.mul(pool.accRewardsPerShare).div(1e18);\n-\n         emit Withdraw(msg.sender, _amount);\n     }\n ", "project_link": "https://github.com/Dinosaur-eggs/core/commit/f642a15f54e1e2c6e785eaaf826f1cbc585e2c2d", "solc_version": "0.8.0", "packages": "", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "40e6716b2174b41daf9a28cb3c53c23c78778b99"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "f642a15f54e1e2c6e785eaaf826f1cbc585e2c2d"}}