{"filename": "contracts/PoS.sol", "patch": "@@ -102,16 +102,22 @@ contract PoS is Ownable, InstantiatorImpl, Decorated {\n         uint256 _targetInterval,\n         address _rewardManagerAddress\n     ) public onlyOwner() returns (uint256) {\n-        instance[currentIndex].staking = Staking(_stakingAddress);\n-        instance[currentIndex].blockSelector = BlockSelector(_blockSelectorAddress);\n-        instance[currentIndex].rewardManager = RewardManager(\n+        // index is incremented at the beggining to stop reentrancy possibilities\n+        // TODO: study using ReentrancyGuard contract\n+        currentIndex++;\n+\n+        instance[currentIndex - 1].staking = Staking(_stakingAddress);\n+        instance[currentIndex - 1].blockSelector = BlockSelector(_blockSelectorAddress);\n+        instance[currentIndex - 1].rewardManager = RewardManager(\n             _rewardManagerAddress\n         );\n-        instance[currentIndex].workerAuth = WorkerAuthManager(\n+        instance[currentIndex - 1].workerAuth = WorkerAuthManager(\n             _workerAuthAddress\n         );\n \n-        instance[currentIndex].blockSelectorIndex = instance[currentIndex]\n+        active[currentIndex - 1] = true;\n+\n+        instance[currentIndex - 1].blockSelectorIndex = instance[currentIndex -1]\n             .blockSelector\n             .instantiate(\n             _minimumDifficulty,\n@@ -121,8 +127,7 @@ contract PoS is Ownable, InstantiatorImpl, Decorated {\n             address(this)\n         );\n \n-        active[currentIndex] = true;\n-        return currentIndex++;\n+        return currentIndex - 1;\n     }\n \n     /// @notice Produce a block", "project_link": "https://github.com/cartesi/pos-dlib/commit/bb087fbdb8de5887b49833cab1050c916aef1eee", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "568e61758bacb6cfba1b956b46e4d80ca388c967"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "bb087fbdb8de5887b49833cab1050c916aef1eee"}}