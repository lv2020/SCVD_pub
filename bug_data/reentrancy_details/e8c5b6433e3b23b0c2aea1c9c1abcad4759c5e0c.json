{"filename": "contracts/protocol/libraries/logic/LiquidationLogic.sol", "patch": "@@ -165,6 +165,13 @@ library LiquidationLogic {\n     if (vars.userTotalDebt == vars.actualDebtToLiquidate) {\n       userConfig.setBorrowing(debtReserve.id, false);\n     }\n+    \n+    // If the collateral being liquidated is equal to the user balance,\n+    // we set the currency as not being used as collateral anymore\n+    if (vars.actualCollateralToLiquidate == vars.userCollateralBalance) {\n+      userConfig.setUsingAsCollateral(collateralReserve.id, false);\n+      emit ReserveUsedAsCollateralDisabled(params.collateralAsset, params.user);\n+    }\n \n     _burnDebtTokens(params, vars);\n \n@@ -198,13 +205,6 @@ library LiquidationLogic {\n       );\n     }\n \n-    // If the collateral being liquidated is equal to the user balance,\n-    // we set the currency as not being used as collateral anymore\n-    if (vars.actualCollateralToLiquidate == vars.userCollateralBalance) {\n-      userConfig.setUsingAsCollateral(collateralReserve.id, false);\n-      emit ReserveUsedAsCollateralDisabled(params.collateralAsset, params.user);\n-    }\n-\n     // Transfers the debt asset being repaid to the aToken, where the liquidity is kept\n     IERC20(params.debtAsset).safeTransferFrom(\n       msg.sender,", "project_link": "https://github.com/aave/aave-v3-core/commit/cd508a713d3cdd4e09c514fe0c47cf8f51383b07", "solc_version": "0.8.10", "packages": "", "bug_version": {"raw_code": "", "flattened_code": "", "commit_id": "e8c5b6433e3b23b0c2aea1c9c1abcad4759c5e0c"}, "fixed_version": {"raw_code": "", "flattened_code": "", "commit_id": "cd508a713d3cdd4e09c514fe0c47cf8f51383b07"}}